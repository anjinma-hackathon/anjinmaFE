# 백엔드 확인 필요 사항 (WebSocket 학생 입장 문제)

## 🔴 1. 구독 시점 초기 스냅샷 전송 여부

**질문**: 교수 화면이 `/sub/rooms/{roomId}/attendance`를 구독할 때, 백엔드가 **즉시 현재 입장한 학생 목록을 스냅샷으로 전송**하나요?

**현재 상황**:
- 학생이 먼저 입장하고 교수가 나중에 구독하는 경우
- 교수가 구독 시점에 이미 입장한 학생들이 안 보일 수 있음

**기대 동작**:
```json
{
  "type": "snapshot",
  "students": [
    { "studentId": "20231234", "studentName": "홍길동", "language": "en" },
    { "studentId": "20231235", "studentName": "김철수", "language": "ja" }
  ]
}
```

**확인 필요**:
- [ ] 구독 시점에 초기 스냅샷을 보내는가?
- [ ] 스냅샷 형식이 `{ type: "snapshot", students: [...] }`인가?

---

## 🔴 2. 학생 입장 메시지 처리 및 스냅샷 브로드캐스트

**질문**: 학생이 `/pub/attendance/{roomId}`로 `StudentJoinMessage`를 발행하면, 백엔드가 이를 받아서 **모든 교수에게 스냅샷을 브로드캐스트**하나요?

**학생이 보내는 메시지**:
```json
{
  "studentId": "20231234",
  "studentName": "홍길동",
  "language": "en"
}
```

**기대 동작**:
1. 백엔드가 학생 입장 메시지를 수신
2. 학생을 입장 목록에 추가
3. `/sub/rooms/{roomId}/attendance`를 구독한 모든 교수에게 스냅샷 브로드캐스트

**확인 필요**:
- [ ] 학생 입장 메시지를 수신하는가?
- [ ] 수신 후 스냅샷을 생성하여 브로드캐스트하는가?
- [ ] 스냅샷에 새로 입장한 학생이 포함되는가?

---

## 🔴 3. WebSocket 주소 및 라우팅 확인

**질문**: 다음 주소들이 올바르게 라우팅되나요?

**발행 주소**:
- `/pub/attendance/{roomId}` - 학생 입장 메시지
- `/pub/lecture/{roomId}` - 교수 자막 발행

**구독 주소**:
- `/sub/rooms/{roomId}/attendance` - 교수 입장 명단 구독
- `/sub/rooms/{roomId}` - 학생/교수 자막 구독

**확인 필요**:
- [ ] `/pub/attendance/{roomId}`로 발행된 메시지를 수신하는가?
- [ ] `/sub/rooms/{roomId}/attendance`를 구독한 클라이언트에게 메시지를 전달하는가?
- [ ] 주소 형식이 정확한가? (슬래시, 대소문자 등)

---

## 🔴 4. 메시지 형식 및 필드명 확인

**질문**: 다음 메시지 형식들이 정확한가요?

### StudentJoinMessage (학생 입장)
```json
{
  "studentId": "20231234",
  "studentName": "홍길동",
  "language": "en"
}
```

### StudentListMessage (스냅샷)
```json
{
  "type": "snapshot",
  "students": [
    {
      "studentId": "20231234",
      "studentName": "홍길동",
      "language": "en"
    }
  ]
}
```

**확인 필요**:
- [ ] 필드명이 정확한가? (`studentId`, `studentName`, `language`)
- [ ] `type: "snapshot"` 필드가 있는가?
- [ ] `students` 배열이 정확한가?

---

## 🔴 5. WebSocket 연결 및 인증 확인

**질문**: WebSocket 연결 시 인증이나 권한 체크가 필요한가요?

**확인 필요**:
- [ ] 교수만 `/sub/rooms/{roomId}/attendance`를 구독할 수 있는가?
- [ ] 학생만 `/pub/attendance/{roomId}`로 발행할 수 있는가?
- [ ] 인증 토큰이나 헤더가 필요한가?
- [ ] roomId 검증을 하는가?

---

## 🔴 6. 에러 처리 및 로깅

**질문**: 다음 상황에서 백엔드가 어떻게 처리하나요?

**확인 필요**:
- [ ] 잘못된 주소로 발행된 메시지는 어떻게 처리되나요?
- [ ] 존재하지 않는 roomId로 발행/구독하면 어떻게 되나요?
- [ ] 메시지 형식이 잘못되면 어떻게 되나요?
- [ ] 에러 로그를 남기나요?

---

## 🔴 7. 실시간 업데이트 동작 방식

**질문**: 학생 입장/퇴장 시 실시간 업데이트가 어떻게 동작하나요?

**확인 필요**:
- [ ] 학생 입장 시 즉시 스냅샷을 브로드캐스트하나요?
- [ ] 학생 퇴장 시 스냅샷을 업데이트하여 브로드캐스트하나요?
- [ ] 여러 학생이 동시에 입장하면 어떻게 처리하나요?
- [ ] 스냅샷이 누락될 수 있나요?

---

## 🔴 8. 테스트 시나리오 확인

**질문**: 다음 시나리오에서 정상 동작하나요?

### 시나리오 1: 학생 먼저 입장
1. 학생 A가 입장 메시지 발행
2. 교수가 나중에 구독
3. **기대**: 교수가 구독 시점에 학생 A가 포함된 스냅샷을 받아야 함

### 시나리오 2: 교수 먼저 구독
1. 교수가 구독
2. 학생 A가 입장 메시지 발행
3. **기대**: 교수가 학생 A가 포함된 스냅샷을 받아야 함

### 시나리오 3: 여러 학생 동시 입장
1. 교수가 구독
2. 학생 A, B, C가 거의 동시에 입장 메시지 발행
3. **기대**: 교수가 모든 학생이 포함된 스냅샷을 받아야 함

---

## 🔴 9. 디버깅을 위한 로그 확인

**질문**: 다음 상황에서 백엔드 로그를 확인할 수 있나요?

**확인 필요**:
- [ ] 학생 입장 메시지 수신 로그
- [ ] 스냅샷 생성 로그
- [ ] 스냅샷 브로드캐스트 로그
- [ ] 구독자 목록 로그
- [ ] 에러 로그

**요청 사항**:
- 학생 입장 메시지가 도착했는지 확인
- 스냅샷이 생성되었는지 확인
- 구독한 교수에게 스냅샷이 전송되었는지 확인

---

## 🔴 10. 현재 동작 상태 확인

**질문**: 현재 백엔드에서 다음 기능들이 구현되어 있나요?

**확인 필요**:
- [ ] `/pub/attendance/{roomId}` 엔드포인트가 활성화되어 있나요?
- [ ] `/sub/rooms/{roomId}/attendance` 구독이 동작하나요?
- [ ] 학생 입장 메시지를 받아서 처리하나요?
- [ ] 스냅샷을 생성하여 브로드캐스트하나요?

---

## 📋 백엔드에 전달할 요약 질문

1. **구독 시점에 초기 스냅샷을 보내나요?**
2. **학생 입장 메시지를 받아서 스냅샷을 브로드캐스트하나요?**
3. **주소 라우팅이 올바르게 설정되어 있나요?** (`/pub/attendance/{roomId}`, `/sub/rooms/{roomId}/attendance`)
4. **메시지 형식이 정확한가요?** (StudentJoinMessage, StudentListMessage)
5. **에러 로그를 확인할 수 있나요?** (학생 입장 메시지 수신, 스냅샷 생성, 브로드캐스트)

---

## 🧪 테스트 요청

**백엔드에 요청할 테스트**:
1. 학생 입장 메시지를 `/pub/attendance/{roomId}`로 발행
2. 백엔드 로그에서 메시지 수신 확인
3. 스냅샷 생성 확인
4. `/sub/rooms/{roomId}/attendance`를 구독한 클라이언트에게 전송 확인
5. 구독 시점에 초기 스냅샷 전송 확인

